@model CitaFacil.ViewModels.Account.LoginViewModel

@{
    Layout = "_LoginLayout";
    ViewData["Title"] = "Iniciar sesión";
    // NO definimos ViewData["UseWideLayout"], por lo que usará el layout angosto por defecto (480px)
}

<div class="flex w-full flex-col items-center rounded-3xl bg-white p-8 shadow-xl md:p-12">
    <div class="mb-8 flex flex-col items-center">
        <a asp-controller="Home" asp-action="Index" class="group flex flex-col items-center transition-all hover:opacity-90">
            <div class="mb-3 flex h-14 w-14 items-center justify-center rounded-2xl bg-primary/10 text-primary shadow-sm transition group-hover:scale-110 group-hover:bg-primary group-hover:text-white">
                <span class="material-symbols-outlined text-3xl">health_and_safety</span>
            </div>
            <h1 class="text-3xl font-black tracking-tight text-slate-800">CitaFácil</h1>
        </a>
        <p class="mt-2 text-center text-slate-500">Bienvenido de nuevo, ingresa tus credenciales.</p>
    </div>

    <form asp-controller="Account" asp-action="Login" method="post" class="w-full space-y-5">
        @Html.AntiForgeryToken()

        @if (!ViewData.ModelState.IsValid)
        {
            <div asp-validation-summary="ModelOnly" class="rounded-xl border border-red-100 bg-red-50 p-3 text-center text-sm font-medium text-red-600"></div>
        }

        <div class="space-y-1">
            <label asp-for="identificador" class="ml-1 text-sm font-bold text-slate-700">Usuario o Correo</label>
            <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-slate-400">
                    <span class="material-symbols-outlined text-xl">person</span>
                </span>
                <input asp-for="identificador" class="form-input h-12 w-full rounded-xl border-slate-200 bg-slate-50 pl-11 focus:border-primary focus:bg-white focus:ring-primary" placeholder="ejemplo@correo.com" />
            </div>
            <span asp-validation-for="identificador" class="ml-1 text-xs text-red-500"></span>
        </div>

        <div class="space-y-1">
            <div class="flex items-center justify-between px-1">
                <label asp-for="contraseña" class="text-sm font-bold text-slate-700">Contraseña</label>
                <a asp-action="ProtoLogin" class="text-xs font-semibold text-primary hover:text-primary-dark hover:underline">¿Olvidaste tu contraseña?</a>
            </div>
            <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-slate-400">
                    <span class="material-symbols-outlined text-xl">lock</span>
                </span>
                <input asp-for="contraseña" id="password-input" type="password" class="form-input h-12 w-full rounded-xl border-slate-200 bg-slate-50 pl-11 pr-12 focus:border-primary focus:bg-white focus:ring-primary" placeholder="••••••••" />
                <button type="button" id="password-toggle" class="absolute inset-y-0 right-0 flex items-center pr-4 text-slate-400 transition hover:text-slate-600 focus:outline-none">
                    <span class="material-symbols-outlined text-xl">visibility</span>
                </button>
            </div>
            <span asp-validation-for="contraseña" class="ml-1 text-xs text-red-500"></span>
        </div>

        <button type="submit" class="mt-4 flex h-12 w-full items-center justify-center rounded-xl bg-primary font-bold text-white shadow-lg shadow-primary/20 transition hover:bg-primary-dark hover:shadow-primary/40 active:scale-[0.98]">
            Iniciar Sesión
        </button>
    </form>

    <div class="mt-8 text-center text-sm text-slate-500">
        ¿Aún no tienes cuenta?
        <a asp-action="Register" class="font-bold text-primary hover:text-primary-dark hover:underline">Regístrate aquí</a>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const passwordInput = document.getElementById('password-input');
            const passwordToggle = document.getElementById('password-toggle');

            if (passwordToggle && passwordInput) {
                passwordToggle.addEventListener('click', function () {
                    const icon = this.querySelector('span');
                    const isPassword = passwordInput.getAttribute('type') === 'password';
                    passwordInput.setAttribute('type', isPassword ? 'text' : 'password');
                    if (icon) {
                        icon.textContent = isPassword ? 'visibility_off' : 'visibility';
                    }
                });
            }
        });
    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}