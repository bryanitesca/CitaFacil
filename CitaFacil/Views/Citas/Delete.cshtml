@model CitaFacil.Models.Cita
@using System.Globalization
@using System.Linq

@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Cancelar cita";

    static string ConstruirNombreCompleto(string? nombre, string? apellido, string? segundoApellido)
    {
        var partes = new[] { nombre, apellido, segundoApellido }
            .Where(s => !string.IsNullOrWhiteSpace(s))
            .Select(s => s!.Trim());
        var resultado = string.Join(" ", partes);
        return string.IsNullOrWhiteSpace(resultado) ? "--" : resultado;
    }

    var cultura = CultureInfo.GetCultureInfo("es-MX");
    var fechaFormateada = Model.fecha.ToString("dddd, dd 'de' MMMM yyyy", cultura);
    var horaFormateada = Model.hora.ToString(@"hh\:mm");
    var paciente = ConstruirNombreCompleto(Model.Paciente?.nombre, Model.Paciente?.apellido, Model.Paciente?.segundo_apellido);
    var doctor = ConstruirNombreCompleto(Model.Doctor?.nombre, Model.Doctor?.apellido, Model.Doctor?.segundo_apellido);
}

<div class="space-y-8">
    <div class="flex items-center justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold tracking-[-0.03em] text-slate-900 dark:text-slate-100">Cancelar cita</h1>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Confirma si deseas eliminar de forma permanente la cita seleccionada.</p>
        </div>
        <a asp-action="Index" class="inline-flex items-center gap-2 rounded-lg border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-primary hover:text-primary dark:border-slate-700 dark:text-slate-300 dark:hover:border-primary dark:hover:text-primary">
            <span class="material-symbols-outlined text-sm">arrow_back</span>
            Volver
        </a>
    </div>

    <div class="rounded-2xl border border-red-200 bg-red-50/70 p-8 shadow-sm dark:border-red-700 dark:bg-red-900/30">
        <header class="flex items-start gap-4 border-b border-red-200 pb-6 dark:border-red-700">
            <span class="material-symbols-outlined text-3xl text-red-500">warning</span>
            <div>
                <h2 class="text-xl font-semibold text-red-600 dark:text-red-300">Esta acción no se puede deshacer</h2>
                <p class="mt-1 text-sm text-red-700/90 dark:text-red-200">Eliminarás todos los registros asociados a la cita y no podrás recuperarlos.</p>
            </div>
        </header>

        <div class="mt-6 grid gap-6 sm:grid-cols-2">
            <div class="rounded-xl border border-white/60 bg-white/80 px-6 py-5 shadow-sm backdrop-blur dark:border-red-800/40 dark:bg-red-900/60">
                <p class="text-xs uppercase text-red-500/80">Paciente</p>
                <p class="mt-1 text-base font-semibold text-red-700 dark:text-red-200">@paciente</p>
                <p class="text-xs text-red-500/70 dark:text-red-300/80">ID: @Model.paciente_id</p>
            </div>

            <div class="rounded-xl border border-white/60 bg-white/80 px-6 py-5 shadow-sm backdrop-blur dark:border-red-800/40 dark:bg-red-900/60">
                <p class="text-xs uppercase text-red-500/80">Doctor</p>
                <p class="mt-1 text-base font-semibold text-red-700 dark:text-red-200">@doctor</p>
                <p class="text-xs text-red-500/70 dark:text-red-300/80">ID: @Model.doctor_id</p>
            </div>

            <div class="rounded-xl border border-white/60 bg-white/80 px-6 py-5 shadow-sm backdrop-blur dark:border-red-800/40 dark:bg-red-900/60">
                <p class="text-xs uppercase text-red-500/80">Fecha y hora</p>
                <p class="mt-1 text-base font-semibold text-red-700 dark:text-red-200">@fechaFormateada</p>
                <p class="text-xs text-red-500/70 dark:text-red-300/80">Horario: @horaFormateada h</p>
            </div>

            <div class="rounded-xl border border-white/60 bg-white/80 px-6 py-5 shadow-sm backdrop-blur dark:border-red-800/40 dark:bg-red-900/60">
                <p class="text-xs uppercase text-red-500/80">Motivo</p>
                <p class="mt-1 text-sm text-red-700 dark:text-red-200">@(!string.IsNullOrWhiteSpace(Model.motivo) ? Model.motivo : "Sin especificar")</p>
            </div>
        </div>

        <form asp-action="Delete" method="post" class="mt-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-end">
            <input type="hidden" asp-for="id" />
            <a asp-action="Index" class="inline-flex items-center justify-center gap-2 rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-primary hover:text-primary dark:border-red-700/60 dark:bg-red-900/40 dark:text-red-200">
                Cancelar
            </a>
            <button type="submit" class="inline-flex items-center justify-center gap-2 rounded-lg bg-red-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-red-700">
                <span class="material-symbols-outlined text-sm">delete_forever</span>
                Sí, eliminar cita
            </button>
        </form>
    </div>
</div>
